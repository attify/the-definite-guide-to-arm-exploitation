//heap2.c
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

struct bookmark
{
    char link[256];
    struct bookmark *next;
};

/*
Pointer to the start of the linked list
*/
struct bookmark *HEAD = NULL;

void backdoor()
{
    printf("Congrats, you've won\n");
    printf("Enjoy your shell\n");
    system("/bin/sh");
}

/*
Add a bookmark to the list
*/
void add_bookmark()
{
    struct bookmark *temp, *new_bookmark;

    new_bookmark = malloc(sizeof(struct bookmark));
    new_bookmark->next = NULL;
    printf("Enter link: ");
    fgets(new_bookmark->link, 256, stdin);
    new_bookmark->link[strcspn(new_bookmark->link, "\n")] = '\0';

    if (HEAD == NULL)
    {
        HEAD = new_bookmark;
    }
    else
    {
        temp = HEAD;
        while (temp->next)
        {
            temp = temp->next;
        }
        temp->next = new_bookmark;
    }
}

/*
Edits an existing bookmark
*/
void edit_bookmark()
{
    int idx, edit_idx;

    if (HEAD == NULL)
    {
        printf("Bookmark list is empty!\n");
    }
    else
    {
        printf("Enter bookmark index that you want to edit? ");
        scanf("%d", &edit_idx);
        getchar();

        struct bookmark *temp = HEAD;
        idx = 1;

        while (idx < edit_idx && temp->next)
        {
            temp = temp->next;
            idx++;
        }
        if (idx != edit_idx)
        {
            printf("No such bookmark!\n");
        }
        else
        {
            printf("Enter new link: ");

            //Buffer overflow here
            gets(temp->link);
        }
    }
}

/*
Prints all bookmarks in the list
*/
void print_bookmarks()
{
    struct bookmark *iterator = HEAD;

    if (HEAD)
    {
        printf("Printing all bookmarks\n");
        printf("----------------------\n");
        do
        {
            printf("%s\n", iterator->link);
            iterator = iterator->next;
        }
        while(iterator);
    }
}

/*
Main function
*/
void main()
{
    setvbuf(stdout, NULL, _IONBF, 0);
    char user_choice;

    while (1)
    {
        printf("\n1. Add a bookmark\n");
        printf("2. Edit a bookmark\n");
        printf("3. View all bookmarks\n");
        printf("4. Exit\n\n");
        printf("Enter your choice: ");

        scanf("%c", &user_choice);
        getchar();

        if (user_choice == '1') add_bookmark();
        else if (user_choice == '2') edit_bookmark();
        else if (user_choice == '3') print_bookmarks();
        else if (user_choice == '4') break;
        else printf("Invalid choice!\n");
    }
}