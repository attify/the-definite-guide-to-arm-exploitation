//double-free2.c
#include <stdio.h>
#include <stdlib.h>

#define MALLOC_SIZE 8

void main()
{
    printf("Allocating %d bytes...\n", MALLOC_SIZE);
    void *a = malloc(MALLOC_SIZE);
    printf("a=%p\n", a);
    
    printf("Allocating %d bytes...\n", MALLOC_SIZE);
    void *b = malloc(MALLOC_SIZE);
    printf("b=%p\n", b);
    
    printf("Freeing %p\n", a);
    free(a);
    
    printf("If we free %p again it will throw a double-free error\n", a);
    printf("Freeing %p instead\n", b);
    
    free(b);
    
    printf("Now we can free %p again\n", a);
    free(a);
}