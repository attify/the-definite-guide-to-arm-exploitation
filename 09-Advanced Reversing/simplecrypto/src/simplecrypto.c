#include <stdio.h>
#include <string.h>
#include <stdlib.h>


// Base64 code taken from
//http://web.mit.edu/freebsd/head/contrib/wpa/src/utils/base64.c

static const unsigned char base64_table[65] =
	"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";

unsigned char * base64_encode(const unsigned char *src, size_t len,
			      size_t *out_len)
{
	unsigned char *out, *pos;
	const unsigned char *end, *in;
	size_t olen;

	olen = len * 4 / 3 + 4; /* 3-byte blocks to 4-byte */
	olen += olen / 72; /* line feeds */
	olen++; /* nul termination */
	if (olen < len)
		return NULL; /* integer overflow */
	out = malloc(olen);
	if (out == NULL)
		return NULL;

	end = src + len;
	in = src;
	pos = out;
	while (end - in >= 3) {
		*pos++ = base64_table[in[0] >> 2];
		*pos++ = base64_table[((in[0] & 0x03) << 4) | (in[1] >> 4)];
		*pos++ = base64_table[((in[1] & 0x0f) << 2) | (in[2] >> 6)];
		*pos++ = base64_table[in[2] & 0x3f];
		in += 3;
	}

	if (end - in) {
		*pos++ = base64_table[in[0] >> 2];
		if (end - in == 1) {
			*pos++ = base64_table[(in[0] & 0x03) << 4];
			*pos++ = '=';
		} else {
			*pos++ = base64_table[((in[0] & 0x03) << 4) |
					      (in[1] >> 4)];
			*pos++ = base64_table[(in[1] & 0x0f) << 2];
		}
		*pos++ = '=';
	}

	*pos = '\0';
	if (out_len)
		*out_len = pos - out;
	return out;
}

void xor_buffer(char *buffer, int length)
{
	int i;
	for (i = 0; i < length; i++)
	{
		buffer[i] ^= (i+1);
	}
}

unsigned int rotate_left(unsigned int value, unsigned int shift)
{
	return (value << shift) | (value >> (32-shift));
}

void rotate(char *buffer, int length)
{
	unsigned int i, dword;
	for (i = 0; i < length/4; i++)
	{
		dword = ((unsigned int*)buffer)[i];
		dword = rotate_left(dword, 5);
		((unsigned int*)buffer)[i] = dword;
	}
}

//this_is_a_secret
//rk5N7Urrje4NrQovzI1PjQ==

void main()
{
	int pass_len;
	char password[20];
	puts("Enter login password: ");
	fgets(password, 20, stdin);
	password[strlen(password)-1] = '\0';
	pass_len = strlen(password);
	xor_buffer(password, pass_len);
	rotate(password, pass_len);
	puts("");
	if (!strcmp(base64_encode(password, pass_len, NULL), "rk5N7Urrje4NrQovzI1PjQ=="))
		puts("======== [ Access Granted ] ========");
	else
		puts("======== [ Access  Denied ] ========");
}