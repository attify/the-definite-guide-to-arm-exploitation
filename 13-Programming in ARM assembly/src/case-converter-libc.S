//case-converter-libc.S
.text

.global main
main:

.code 32

// ==============================================
//          Read the string into buffer
// ==============================================
ldr r0, =buffer         // char *s
mov r1, #buffer_len     // int size
ldr r2, =stdin
ldr r2, [r2]            // FILE *stream
bl fgets

// ==============================================
//       Set up the registers for looping
// ==============================================
ldr r1, =buffer
mov r2, #0              // r2 is used as an index

// ==============================================
// Loop over the buffer, checking each character
// and converting to uppercase as necessary
// ==============================================
loop:
ldrb r3, [r1, r2]       // char = buffer[r2]
cmp r3, #0              // char == 0
beq exit_loop          // go to exit_loop if char == 0
mov r0, r3              // char_copy  = char
sub r0, #97             // char_copy -= 97
cmp r0, #26             
sublo r3, r3, #32       // char -= 32 iff char <= 26 
strb r3, [r1, r2]       // buffer[r2] = char
add r2, r2, #1          // r2 += 1
b loop                  // go to loop

exit_loop:

// ==============================================
//              Print the string
// ==============================================
ldr r0, =buffer     // char *s
bl puts

// ==============================================
//                Exit program
// ==============================================
mov r0, #0          // int exit_code
bl exit


.data

.equ buffer_len, 100
buffer: .space buffer_len